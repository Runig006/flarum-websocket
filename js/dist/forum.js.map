{"version":3,"sources":["webpack://@kyrne/websocket/webpack/bootstrap","webpack://@kyrne/websocket/external \"flarum.core.compat['app']\"","webpack://@kyrne/websocket/external \"flarum.core.compat['utils/Stream']\"","webpack://@kyrne/websocket/external \"flarum.core.compat['extend']\"","webpack://@kyrne/websocket/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@kyrne/websocket/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@kyrne/websocket/external \"flarum.core.compat['utils/stringToColor']\"","webpack://@kyrne/websocket/external \"flarum.core.compat['helpers/avatar']\"","webpack://@kyrne/websocket/external \"flarum.core.compat['components/DiscussionPage']\"","webpack://@kyrne/websocket/external \"flarum.core.compat['extensions/afrux-forum-widgets-core/common/components/Widget']\"","webpack://@kyrne/websocket/external \"flarum.core.compat['extensions/afrux-forum-widgets-core/common/extend/Widgets']\"","webpack://@kyrne/websocket/external \"flarum.core.compat['components/LoadingIndicator']\"","webpack://@kyrne/websocket/external \"flarum.core.compat['components/Tooltip']\"","webpack://@kyrne/websocket/external \"flarum.core.compat['components/Link']\"","webpack://@kyrne/websocket/./src/common/Widget/WebsocketOnlineUsersWidget.js","webpack://@kyrne/websocket/./src/common/Widget/RegisterWidget.js","webpack://@kyrne/websocket/external \"flarum.core.compat['common/components/SettingsPage']\"","webpack://@kyrne/websocket/external \"flarum.core.compat['components/ReplyComposer']\"","webpack://@kyrne/websocket/external \"flarum.core.compat['components/ReplyPlaceholder']\"","webpack://@kyrne/websocket/external \"flarum.core.compat['helpers/username']\"","webpack://@kyrne/websocket/external \"flarum.core.compat['components/DiscussionList']\"","webpack://@kyrne/websocket/external \"flarum.core.compat['components/IndexPage']\"","webpack://@kyrne/websocket/external \"flarum.core.compat['common/extend']\"","webpack://@kyrne/websocket/external \"flarum.core.compat['common/components/FieldSet']\"","webpack://@kyrne/websocket/external \"flarum.core.compat['common/components/Switch']\"","webpack://@kyrne/websocket/external \"flarum.core.compat['common/utils/ItemList']\"","webpack://@kyrne/websocket/./src/forum/index.js","webpack://@kyrne/websocket/./src/forum/AddPreferences.js","webpack://@kyrne/websocket/./src/forum/PresenceChannel.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","flarum","core","compat","_setPrototypeOf","setPrototypeOf","__proto__","_inheritsLoose","subClass","superClass","constructor","WebsocketWidget","Widget","oninit","vnode","this","users","loading","guests","oncreate","app","pusher","then","presence","channels","existingMembers","keys","members","removeGuest","session","user","preferences","discloseOnline","length","map","member","includes","id","pushMember","redraw","some","splice","info","push","Stream","color","stringToColor","displayName","avatarUrl","slug","className","icon","title","translator","trans","content","slice","href","route","username","text","avatar","style","count","Widgets","add","component","WebsocketOnlineUsersWidget","isDisabled","placement","position","extend","initializers","SettingsPage","items","FieldSet","label","disabledAutoFresh","toArray","ItemList","Switch","state","disableAutoFresh","onchange","savePreferences","loadPusher","Promise","resolve","reject","socketStatus","$","getScript","forum","attribute","Pusher","logToConsole","wssPort","socket","authEndpoint","cluster","wsHost","window","location","hostname","wsPort","enableStats","encrypted","auth","headers","csrfToken","enabledTransports","disabledTransports","connection","current","main","subscribe","pushedUpdates","DiscussionList","channel","data","String","discussionId","params","discussions","getParams","indexOf","routeName","q","request","method","url","payload","attributes","subscription","filter","tag","ids","relationships","tags","tags_ids","split","forEach","store","getBy","getPages","refresh","matches","IndexPage","setTitleCount","DiscussionPage","discussion","stream","oldCount","commentCount","find","update","document","hasFocus","Math","max","one","unbind","pushAttributes","unreadNotificationCount","newNotificationCount","console","log","element","querySelector","innerHTML","membersOnline","myID","matchMedia","on","e","nav","children","scrollTop","css","addClass","removeClass","unsubscribe","ReplyComposer","interval1","typingTimeout","setTimeout","body","attrs","ReplyPlaceholder","typers","userId","time","Date","interval2","typer","now","has","RegisterWidget"],"mappings":"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","file":"forum.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 29);\n","module.exports = flarum.core.compat['app'];","module.exports = flarum.core.compat['utils/Stream'];","module.exports = flarum.core.compat['extend'];","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  setPrototypeOf(subClass, superClass);\n}","module.exports = flarum.core.compat['utils/stringToColor'];","module.exports = flarum.core.compat['helpers/avatar'];","module.exports = flarum.core.compat['components/DiscussionPage'];","module.exports = flarum.core.compat['extensions/afrux-forum-widgets-core/common/components/Widget'];","module.exports = flarum.core.compat['extensions/afrux-forum-widgets-core/common/extend/Widgets'];","module.exports = flarum.core.compat['components/LoadingIndicator'];","module.exports = flarum.core.compat['components/Tooltip'];","module.exports = flarum.core.compat['components/Link'];","import LoadingIndicator from 'flarum/components/LoadingIndicator';\nimport Tooltip from 'flarum/components/Tooltip';\nimport avatar from 'flarum/helpers/avatar';\nimport Link from 'flarum/components/Link';\nimport stringToColor from 'flarum/utils/stringToColor';\nimport Stream from 'flarum/utils/Stream';\n\nimport Widget from 'flarum/extensions/afrux-forum-widgets-core/common/components/Widget';\n\nlet WebsocketWidget = null;\n\nif (Widget) {\n  WebsocketWidget = class WebsocketOnlineUsersWidget extends Widget {\n    oninit(vnode) {\n      super.oninit(vnode);\n\n      this.users = [];\n      this.loading = true;\n      this.guests = 0;\n    }\n\n    oncreate(vnode) {\n      super.oncreate(vnode);\n\n      app.pusher.then(object => {\n        const presence = object.channels.presence;\n\n        const existingMembers = Object.keys(presence.members.members);\n\n        const removeGuest = !app.session.user || (app.session.user && !app.session.user.preferences().discloseOnline);\n\n        if (existingMembers.length === 0) {\n\n          presence.bind(\"pusher:subscription_succeeded\", members => {\n            Object.keys(members.members).map(member => {\n              if (!member.includes('Guest')) {\n                members.members[member].id = member;\n                this.pushMember(members.members[member]);\n              } else {\n                this.guests++;\n              }\n            })\n            this.loading = false;\n            m.redraw();\n          });\n          if (removeGuest) {\n            this.guests--;\n            m.redraw();\n          }\n        } else {\n          existingMembers.map(member => {\n            if (!member.includes('Guest')) {\n              presence.members.members[member].id = member;\n              this.pushMember(presence.members.members[member]);\n            } else {\n              this.guests++;\n            }\n          })\n          this.loading = false;\n\n          if (removeGuest) {\n            this.guests--;\n            m.redraw();\n          }\n        }\n\n        presence.bind(\"pusher:member_removed\", (member) => {\n          if (typeof member.id !== 'string') {\n            this.users.some((user, i) => {\n              if (user.id() == member.id) {\n                this.users.splice(i, 1);\n                return true;\n              }\n            });\n          } else {\n            this.guests--;\n          }\n          m.redraw();\n        });\n\n        presence.bind(\"pusher:member_added\", (member) => {\n          if (typeof member.id !== 'string') {\n            member.info.id = member.id;\n            this.pushMember(member.info);\n          } else {\n            this.guests++;\n          }\n          m.redraw();\n        });\n      });\n    }\n\n    pushMember(member) {\n      this.users.push({\n        id: Stream(member.id),\n        color: Stream('#' + stringToColor(member.displayName)),\n        displayName: Stream(member.displayName),\n        avatarUrl: Stream(member.avatarUrl),\n        slug: Stream(member.slug)\n      });\n    }\n\n    className() {\n      return 'WebsocketOnlineUsersWidget';\n    }\n\n    icon() {\n      return 'fas fa-user-friends';\n    }\n\n    title() {\n      return app.translator.trans('kyrne-websocket.forum.widget.title');\n    }\n\n    content() {\n      if (this.loading) {\n        return <LoadingIndicator/>;\n      }\n\n      const max = 12;\n      const users = this.users;\n\n      return (\n        <div className=\"WebsocketOnlineUsersWidget-users\">\n          <div className=\"WebsocketOnlineUsersWidget-users-message\">\n            {users.length === 0 ? app.translator.trans('kyrne-websocket.forum.widget.empty') : null}\n          </div>\n          <div className=\"WebsocketOnlineUsersWidget-users-list\">\n            {users.slice(0, max).map((user) => (\n              <Link href={app.route('user', {username: user.slug()})} className=\"WebsocketOnlineUsersWidget-users-item\">\n                <Tooltip text={user.displayName()}>{avatar(user)}</Tooltip>\n              </Link>\n            ))}\n            {this.guests > 0 ?\n              <span style={users.length > 0 ? 'margin-left: 8px' : ''} className=\"WebsocketOnlineUsersWidget-users-guests\">{app.translator.trans('kyrne-websocket.forum.widget.guests', {count: this.guests})}</span>\n            : ''}\n            {users.length > max ? (\n              <span className=\"WebsocketOnlineUsersWidget-users-item WebsocketOnlineUsersWidget-users-item--plus\">\n              <span className=\"Avatar\">{`+${max}`}</span>\n            </span>\n            ) : null}\n          </div>\n        </div>\n      );\n    }\n  }\n} else {\n  WebsocketWidget = class WebsocketOnlineUsersWidget {};\n}\n\nexport default WebsocketWidget;\n","import Widgets from 'flarum/extensions/afrux-forum-widgets-core/common/extend/Widgets';\n\nimport WebsocketOnlineUsersWidget from './WebsocketOnlineUsersWidget';\n\nexport default function(app) {\n  (new Widgets).add({\n    key: 'WebsocketOnlineUsersWidget',\n    component: WebsocketOnlineUsersWidget,\n\n    isDisabled: false,\n\n    placement: 'end',\n    position: 1,\n  }).extend(app, 'kyrne-websocket');\n};\n","module.exports = flarum.core.compat['common/components/SettingsPage'];","module.exports = flarum.core.compat['components/ReplyComposer'];","module.exports = flarum.core.compat['components/ReplyPlaceholder'];","module.exports = flarum.core.compat['helpers/username'];","module.exports = flarum.core.compat['components/DiscussionList'];","module.exports = flarum.core.compat['components/IndexPage'];","module.exports = flarum.core.compat['common/extend'];","module.exports = flarum.core.compat['common/components/FieldSet'];","module.exports = flarum.core.compat['common/components/Switch'];","module.exports = flarum.core.compat['common/utils/ItemList'];","import { extend } from 'flarum/extend';\nimport app from 'flarum/app';\nimport DiscussionList from 'flarum/components/DiscussionList';\nimport DiscussionPage from 'flarum/components/DiscussionPage';\nimport IndexPage from 'flarum/components/IndexPage';\n\nimport addPreferences from './AddPreferences';\nimport PresenceChannel from './PresenceChannel';\nimport RegisterWidget from '../common/Widget/RegisterWidget';\n\napp.initializers.add('kyrne-websocket', () => {\n  addPreferences();\n  const loadPusher = new Promise((resolve, reject) => {\n    if (app.socketStatus !== 'connected') {\n      $.getScript('https://cdn.jsdelivr.net/npm/pusher-js@7.0.3/dist/web/pusher.min.js', () => {\n        if (!app.session.user && app.forum.attribute('websocketAuthOnly')) {\n          return false;\n        }\n        if (app.forum.attribute('debug')) {\n          Pusher.logToConsole = true;\n        }\n        let wssPort = app.forum.attribute('websocketReverseProxy') === '1' ? 443 : app.forum.attribute('websocketPort') || 2083;\n        const socket = new Pusher(app.forum.attribute('websocketKey'), {\n          authEndpoint: app.forum.attribute('apiUrl') + '/websocket/auth',\n          cluster: null,\n          wsHost: app.forum.attribute('websocketHost') || window.location.hostname,\n          wsPort: app.forum.attribute('websocketPort') || 2083,\n          wssPort,\n          enableStats: false,\n          encrypted: app.forum.attribute('websocketSecure'),\n          auth: {\n            headers: {\n              'X-CSRF-Token': app.session.csrfToken\n            }\n          },\n          enabledTransports: [\"ws\", \"flash\"],\n          disabledTransports: ['xhr_polling', 'xhr_streaming', 'sockjs']\n        });\n\n        socket.connection.bind('state_change', (state) => app.socketStatus = state.current);\n\n        return resolve({\n          channels: {\n            main: socket.subscribe('public'),\n            user: app.session.user ? socket.subscribe('private-user' + app.session.user.id()) : null,\n            presence: socket.subscribe('presence-forum')\n          },\n          pusher: socket,\n        });\n      });\n    }\n  });\n\n  app.pusher = loadPusher;\n  app.pushedUpdates = [];\n\n  extend(DiscussionList.prototype, 'oncreate', function (vnode) {\n    app.pusher.then(object => {\n      const channels = object.channels;\n      Object.keys(channels).map((channel) => {\n        if (channels[channel] === null) {\n          return\n        };\n        channels[channel].bind('newPost', data => {\n          const id = String(data.discussionId);\n          const params = app.discussions.getParams();\n          if (['user.posts', 'user.discussions'].indexOf(app.current.data.routeName) !== -1 || app.session.user.preferences().disableAutoFresh == true) {\n            return\n          };\n          if (!params.q) {\n            if ((!app.current.get('discussion') || id !== app.current.get('discussion').id()) && app.pushedUpdates.indexOf(id) === -1) {\n              app.request({\n                method: 'GET',\n                url: app.forum.attribute('apiUrl') + '/discussions/' + id,\n              }).then(payload => {\n                if (payload.data.attributes.subscription === 'ignore') {\n                  return\n                }\n                if (params.filter && params.filter.tag) {\n                  let ids = payload.data.relationships.tags.data.map(function (t) {\n                    return t.id;\n                  });\n\n                  let tags_ids = [];\n                  let slugs = params.filter.tag.split(',');\n                  slugs.forEach(function (slug) {\n                    let tag = app.store.getBy('tags', 'slug', slug);\n                    if (tag) {\n                      tags_ids.push(tag.data.id);\n                    }\n                  });\n                  \n                  let found = ids.some(r=> tags_ids.includes(r));\n                  if (found == false) {\n                    return\n                  };\n                }\n                if (app.forum.attribute('websocketAutoUpdate')) {\n                  let pages = app.discussions.getPages();\n                  for (let p = pages.length; p > 0; p--) {\n                    app.discussions.refresh(p);\n                  }\n                } else {\n                  app.pushedUpdates.push(payload);\n                  if (app.current.matches(IndexPage)) {\n                    app.setTitleCount(app.pushedUpdates.length);\n                  }\n                  m.redraw();\n                }\n              });\n            }\n          }\n        });\n      });\n    });\n  });\n\n  extend(DiscussionPage.prototype, 'oncreate', function () {\n    app.pusher.then(object => {\n      const channels = object.channels;\n      Object.keys(channels).map((channel) => {\n        if (channels[channel] === null) {\n          return\n        };\n        channels[channel].bind('newPost', data => {\n          const id = String(data.discussionId);\n          if (this.discussion && this.discussion.id() === id && this.stream) {\n            const oldCount = this.discussion.commentCount();\n            app.store.find('discussions', this.discussion.id()).then(() => {\n              this.stream.update().then(() => {\n                if (!document.hasFocus()) {\n                  app.setTitleCount(Math.max(0, this.discussion.commentCount() - oldCount));\n                  $(window).one('focus', () => app.setTitleCount(0));\n                }\n                m.redraw();\n              })\n            });\n          }\n        });\n      });\n    });\n  });\n\n  //Disable NewPost chanel when going outside from DiscussionPage\n  extend(DiscussionPage.prototype, 'onremove', function () {\n    app.pusher.then(object => {\n      const channels = object.channels;\n      Object.keys(channels).map((channel) => {\n        if (channels[channel] === null) return;\n        channels[channel].unbind('newPost');\n      });\n    });\n  })\n\n  //Notifications channel\n  app.pusher.then(object => {\n    const channels = object.channels;\n    if (channels.user) {\n      channels.user.bind('notification', () => {\n        app.session.user.pushAttributes({\n          unreadNotificationCount: app.session.user.unreadNotificationCount() + 1,\n          newNotificationCount: app.session.user.newNotificationCount() + 1\n        });\n        m.redraw();\n        console.log(app.session.user.unreadNotificationCount());\n        let element = document.querySelector(\".MobileTab .item-notifications .unread\");\n        if (element) {\n            element.innerHTML = app.session.user.unreadNotificationCount();\n        }\n      });\n    }\n  });\n  PresenceChannel();\n  if (app.initializers.has('afrux/forum-widgets-core')) {\n    RegisterWidget(app);\n  }\n});\n","import { extend, override } from 'flarum/common/extend';\nimport FieldSet from 'flarum/common/components/FieldSet';\nimport SettingsPage from 'flarum/common/components/SettingsPage';\nimport Switch from 'flarum/common/components/Switch';\nimport ItemList from 'flarum/common/utils/ItemList';\n\nexport default function () {\n    extend(SettingsPage.prototype, 'settingsItems', function (items) {\n        items.add(\n            'disabler-auto-fresh',\n            FieldSet.component(\n                {\n                    label: app.translator.trans('kyrne-websocket.forum.settings.heading'),\n                    className: 'disable-auto-fresh',\n                },\n                this.disabledAutoFresh().toArray()\n            )\n        );\n    });\n\n    SettingsPage.prototype['disabledAutoFresh'] = function () {\n        const items = new ItemList();\n        items.add(\n            'disable-auto-fresh',\n            Switch.component(\n                {\n                    state: this.user.preferences().disableAutoFresh,\n                    onchange: (value) => {\n                        this.disableAutoFresh = value;\n                        this.user.savePreferences({ disableAutoFresh: value }).then(() => {\n                            m.redraw();\n                        });\n                    },\n                },\n                app.translator.trans('kyrne-websocket.forum.settings.label')\n            )\n        );\n        return items;\n    };\n}","import {extend} from 'flarum/extend';\nimport DiscussionPage from 'flarum/components/DiscussionPage';\nimport ReplyComposer from 'flarum/components/ReplyComposer';\nimport ReplyPlaceholder from 'flarum/components/ReplyPlaceholder';\nimport avatar from 'flarum/helpers/avatar';\nimport username from 'flarum/helpers/username';\nimport Stream from 'flarum/utils/Stream';\nimport stringToColor from 'flarum/utils/stringToColor';\n\nexport default function () {\n  extend(DiscussionPage.prototype, 'view', function (vnode) {\n    app.pusher.then(object => {\n      if (!app.discussions.presence && this.discussion) {\n        app.discussions.presence = object.pusher.subscribe('presence-' + this.discussion.id());\n\n        app.discussions.presence.bind(\"pusher:subscription_succeeded\", (members) => {\n          this.membersOnline = [];\n          Object.keys(members.members).map(member => {\n            if (app.discussions.presence.members.myID != member && typeof member !== 'string') {\n              this.membersOnline.push({\n                id: Stream(member),\n                color: Stream('#' + stringToColor(members.members[member].displayName)),\n                displayName: Stream(members.members[member].displayName),\n                avatarUrl: Stream(members.members[member].avatarUrl)\n              });\n              m.redraw();\n            }\n          })\n        });\n\n        app.discussions.presence.bind(\"pusher:member_removed\", (member) => {\n          this.membersOnline.some((user, i) => {\n            if (user.id() == member.id) {\n              this.membersOnline.splice(i, 1);\n              m.redraw();\n              return true;\n            }\n          });\n        });\n\n        app.discussions.presence.bind(\"pusher:member_added\", (member) => {\n          if (app.discussions.presence.members.myID != member.id && typeof member.id !== 'string') {\n            this.membersOnline.push({\n              id: Stream(member.id),\n              color: Stream('#' + stringToColor(member.info.displayName)),\n              displayName: Stream(member.info.displayName),\n              avatarUrl: Stream(member.info.avatarUrl)\n            });\n            m.redraw();\n          }\n        });\n      }\n    });\n  });\n\n  extend(DiscussionPage.prototype, 'sidebarItems', function (items) {\n    if (this.membersOnline && this.membersOnline.length) {\n      items.add('viewing',\n        <div className=\"UsersOnline\">\n          <legend\n            className=\"UsersOnline-title\">{app.translator.trans('kyrne-websocket.forum.discussion_page.viewing_title')}</legend>\n          <ul className=\"UsersOnline-list\">\n            {this.membersOnline.map(user => {\n              return <li className=\"UsersOnline-item\">\n                {avatar(user)}\n                {username(user)}\n              </li>\n            })}\n          </ul>\n        </div>\n        , -101)\n    }\n  });\n\n  extend(DiscussionPage.prototype, 'oncreate', function (vnode) {\n    if (!window.matchMedia(\"only screen and (max-width: 767px)\").matches) {\n      $(window).on('scroll', function (e) {\n        const nav = $('.DiscussionPage-nav').children();\n        if ($(window).scrollTop() > 147) {\n          nav.css('position', 'fixed');\n          nav.addClass('websocket-nav');\n        } else {\n          nav.css('position', 'absolute');\n          nav.removeClass('websocket-nav');\n        }\n      })\n    }\n  });\n\n  extend(DiscussionPage.prototype, 'onremove', function (vnode) {\n    app.pusher.then(object => {\n      if (app.discussions.presence) {\n        app.discussions.presence = object.pusher.unsubscribe('presence-' + this.discussion.id());\n        app.discussions.presence = null;\n      }\n    });\n  });\n\n  extend(ReplyComposer.prototype, 'oninit', function () {\n    const interval1 = () => {\n      this.typingTimeout = true;\n      setTimeout(() => {\n        interval1();\n      }, 18000);\n    };\n\n    interval1();\n  });\n\n  extend(ReplyComposer.prototype, 'view', function () {\n    if (app.session.user && app.session.user.preferences().discloseOnline) {\n      $('.TextEditor-editor').on('keydown', () => {\n        if (this.typingTimeout) {\n          this.typingTimeout = false;\n          app.request({\n            method: 'POST',\n            url: app.forum.attribute('apiUrl') + '/posts/typing',\n            body: {\n              discussionId: this.attrs.discussion.id()\n            }\n          })\n        }\n      })\n    }\n  });\n\n  extend(ReplyPlaceholder.prototype, 'oninit', function () {\n    this.typers = {};\n\n    setTimeout(() => {\n      if (app.discussions.presence) {\n        app.discussions.presence.bind('typing', (data) => {\n          if (!this.typers[data.userId] && data.userId != app.discussions.presence.members.myID) {\n            this.typers[data.userId] = {\n              id: Stream(data.userId),\n              color: Stream('#' + stringToColor(data.displayName)),\n              displayName: Stream(data.displayName),\n              avatarUrl: Stream(data.avatarUrl),\n              time: new Date()\n            };\n          }\n\n          m.redraw();\n        })\n      }\n    }, 2000);\n\n    const interval2 = () => {\n      Object.keys(this.typers).map(typer => {\n        if (this.typers[typer].time < new Date(Date.now() - 20000)) {\n          delete this.typers[typer];\n          m.redraw();\n        }\n      })\n      setTimeout(() => {\n        interval2();\n      }, 20000);\n    };\n\n    interval2();\n  });\n\n  extend(ReplyPlaceholder.prototype, 'view', function (vnode) {\n    if (Object.keys(this.typers).length) {\n      vnode.children.push(\n        <div className=\"ReplyPlaceholder-typers\">\n          <ul className=\"ReplyPlaceholder-typers-list\">\n            {Object.keys(this.typers).map(typer => {\n              return <li className=\"ReplyPlaceholder-typers-item\">\n                {avatar(this.typers[typer])}\n                {username(this.typers[typer])}\n                <div className=\"tiblock\">\n                  <div className=\"tidot\"/>\n                  <div className=\"tidot\"/>\n                  <div className=\"tidot\"/>\n                </div>\n              </li>\n            })}\n          </ul>\n        </div>\n      )\n    }\n  });\n}\n"],"sourceRoot":""}